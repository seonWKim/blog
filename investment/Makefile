# Investment Analysis Makefile
#
# This Makefile automates investment analysis tasks including:
# 1. Macro report generation
# 2. Portfolio checklist analysis
# 3. Final combined report

.PHONY: help macro-report checklist final-report all clean

# Variables
TODAY := $(shell date +%Y-%m-%d)
MACRO_SCRIPT := macro/MACRO_RESEARCH_SCRIPT.md
MACRO_REPORTS_DIR := macro/reports
MACRO_REPORT := $(MACRO_REPORTS_DIR)/REPORT_$(TODAY).md
CHECKLIST_FILE := checklist/investment_checklist.md
CHECKLIST_HISTORY_DIR := checklist/history
CHECKLIST_REPORT := $(CHECKLIST_HISTORY_DIR)/REPORT_$(TODAY).md
FINAL_REPORT := $(CHECKLIST_HISTORY_DIR)/FINAL_REPORT_$(TODAY).md

# Colors for output
GREEN := \033[0;32m
YELLOW := \033[0;33m
BLUE := \033[0;34m
RED := \033[0;31m
NC := \033[0m # No Color

help:
	@echo "$(BLUE)Investment Analysis Makefile$(NC)"
	@echo ""
	@echo "$(GREEN)Available targets:$(NC)"
	@echo "  $(YELLOW)make macro-report$(NC)     - Generate macro economic report"
	@echo "  $(YELLOW)make checklist$(NC)         - Run investment portfolio checklist analysis"
	@echo "  $(YELLOW)make final-report$(NC)      - Generate final combined report (requires macro + checklist)"
	@echo "  $(YELLOW)make all$(NC)               - Run macro, checklist, and final report"
	@echo "  $(YELLOW)make setup$(NC)             - Create necessary directories"
	@echo "  $(YELLOW)make clean$(NC)             - Clean up temporary files"
	@echo ""
	@echo "$(GREEN)Examples:$(NC)"
	@echo "  make macro-report"
	@echo "  make checklist"
	@echo "  make final-report"
	@echo "  make all"

# Create necessary directory structure
setup:
	@echo "$(GREEN)Creating directory structure...$(NC)"
	@mkdir -p $(MACRO_REPORTS_DIR)
	@mkdir -p $(CHECKLIST_HISTORY_DIR)
	@echo "$(GREEN)✓ Directories created$(NC)"

# Generate macro economic report
macro-report: setup
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo "$(GREEN)Generating Macro Economic Report for $(TODAY)$(NC)"
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo ""
	@echo "$(YELLOW)Instructions for Claude:$(NC)"
	@echo ""
	@echo "Please execute the macro research script and generate a comprehensive report."
	@echo ""
	@echo "Task: Execute $(MACRO_SCRIPT)"
	@echo "Output: $(MACRO_REPORT)"
	@echo ""
	@echo "$(YELLOW)Full Prompt:$(NC)"
	@echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
	@echo ""
	@echo "Please execute the MACRO_RESEARCH_SCRIPT.md located in macro/."
	@echo ""
	@echo "Research the latest macroeconomic data (last 14-30 days) and generate a comprehensive"
	@echo "report file at macro/reports/REPORT_$(TODAY).md."
	@echo ""
	@echo "The report must be written entirely in Korean (한국어)."
	@echo ""
	@echo "Include:"
	@echo "- 통화정책 및 금리 (Monetary Policy & Interest Rates)"
	@echo "- 인플레이션 및 경제 성장 (Inflation & Economic Growth)"
	@echo "- 통화 및 원자재 (Currency & Commodities)"
	@echo "- 지정학 및 정책 리스크 (Geopolitical & Policy Risks)"
	@echo "- 섹터별 거시경제 인사이트 (Sector-Specific Macro Insights for AEP, DUK, GEV, TER, FORM, DLR, GLD, SMR)"
	@echo "- 시장 심리 및 포지셔닝 (Market Sentiment & Positioning)"
	@echo "- 거시경제 트리거 및 경고 (Macro Triggers & Alerts)"
	@echo "- 거시경제 기반 포트폴리오 권고사항 (Macro-Based Portfolio Recommendations)"
	@echo ""
	@echo "Use WebSearch and WebFetch tools to gather latest data from:"
	@echo "- Federal Reserve, BLS, BEA, EIA"
	@echo "- Bloomberg, Reuters, WSJ, FT"
	@echo "- Trading Economics, FRED"
	@echo ""
	@echo "Cite all sources with dates."
	@echo ""
	@echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
	@echo ""
	@echo "$(GREEN)✓ Macro report prompt displayed. Please copy and paste to Claude.$(NC)"

# Run investment checklist analysis
checklist: setup
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo "$(GREEN)Running Investment Portfolio Checklist for $(TODAY)$(NC)"
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo ""
	@echo "$(YELLOW)Instructions for Claude:$(NC)"
	@echo ""
	@echo "Please execute the investment checklist analysis based on investment_checklist.md"
	@echo ""
	@echo "Input Files:"
	@echo "  - Checklist: $(CHECKLIST_FILE)"
	@echo "  - Previous Reports: $(CHECKLIST_HISTORY_DIR)/*.md"
	@echo ""
	@echo "Output: $(CHECKLIST_REPORT)"
	@echo ""
	@echo "$(YELLOW)Full Prompt:$(NC)"
	@echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
	@echo ""
	@echo "Please execute the investment portfolio checklist analysis."
	@echo ""
	@echo "Instructions:"
	@echo "1. Read checklist/investment_checklist.md"
	@echo "2. Review previous reports in checklist/history/REPORT_*.md"
	@echo "3. Research latest news and data for all holdings (AEP, DUK, GEV, TER, FORM, DLR, GLD, SMR)"
	@echo "4. Analyze each stock's:"
	@echo "   - Logic status (STRONGER/INTACT/WEAKENING/BROKEN)"
	@echo "   - Valuation (Undervalued/Fair/Overvalued/EXPENSIVE)"
	@echo "   - Expected Return (12-month probability-weighted)"
	@echo "   - Portfolio recommendations"
	@echo ""
	@echo "Follow the comprehensive framework in investment_checklist.md:"
	@echo "- Section 0.0: Market-Level Assessment (S&P 500 valuation)"
	@echo "- Section 0.1: Macro Regime Check (Fed, rates, ISM, VIX)"
	@echo "- Section 0.2: Historical Review (compare with previous reports)"
	@echo "- Section 1: Individual Stock Logic Status"
	@echo "- Section 2: Logic + Valuation Check"
	@echo "- Section 3-4: Action Guidelines and DCA Adjustments"
	@echo "- Section 5: Position Sizing (Kelly Criterion)"
	@echo "- Section 7: New Investment Ideas Discovery"
	@echo ""
	@echo "Use WebSearch extensively for:"
	@echo "- Latest company news, earnings, guidance"
	@echo "- Analyst ratings and price targets"
	@echo "- Sector-specific news (utilities, semiconductors, data centers)"
	@echo "- Macro indicators (CPI, PMI, jobs data)"
	@echo ""
	@echo "Generate a comprehensive report in Korean and save to:"
	@echo "checklist/history/REPORT_$(TODAY).md"
	@echo ""
	@echo "The report must include:"
	@echo "- Executive summary"
	@echo "- Market-level valuation assessment"
	@echo "- Macro regime analysis"
	@echo "- Stock-by-stock analysis table"
	@echo "- Portfolio adjustment recommendations"
	@echo "- DCA allocation table"
	@echo "- Risk assessment"
	@echo "- Sources with dates"
	@echo ""
	@echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
	@echo ""
	@echo "$(GREEN)✓ Checklist prompt displayed. Please copy and paste to Claude.$(NC)"

# Generate final combined report (requires both macro and checklist reports)
final-report:
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo "$(GREEN)Generating Final Combined Report for $(TODAY)$(NC)"
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo ""
	@echo "$(YELLOW)Checking required files...$(NC)"
	@test -f $(MACRO_REPORT) && echo "$(GREEN)✓$(NC) Macro report found" || (echo "$(RED)✗$(NC) Macro report not found. Run 'make macro-report' first" && exit 1)
	@test -f $(CHECKLIST_REPORT) && echo "$(GREEN)✓$(NC) Checklist report found" || (echo "$(RED)✗$(NC) Checklist report not found. Run 'make checklist' first" && exit 1)
	@echo ""
	@echo "$(YELLOW)Instructions for Claude:$(NC)"
	@echo ""
	@echo "Please generate a final combined investment report by synthesizing:"
	@echo ""
	@echo "Input Files:"
	@echo "  - Macro Report: $(MACRO_REPORT)"
	@echo "  - Checklist Report: $(CHECKLIST_REPORT)"
	@echo ""
	@echo "Output: $(FINAL_REPORT)"
	@echo ""
	@echo "$(YELLOW)Full Prompt:$(NC)"
	@echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
	@echo ""
	@echo "Please generate a comprehensive final investment report by synthesizing the macro and checklist reports."
	@echo ""
	@echo "Instructions:"
	@echo "1. Read the macro economic report: $(MACRO_REPORT)"
	@echo "2. Read the portfolio checklist report: $(CHECKLIST_REPORT)"
	@echo "3. Synthesize both reports into a single executive summary"
	@echo ""
	@echo "The final report should include:"
	@echo ""
	@echo "## 1. Executive Summary (경영진 요약)"
	@echo "- Overall market conditions and macro regime"
	@echo "- Portfolio health status (number of stocks: STRONGER/INTACT/WEAKENING/BROKEN)"
	@echo "- Key actions required this week"
	@echo "- Major risks and opportunities"
	@echo ""
	@echo "## 2. Macro-Driven Insights (거시경제 인사이트)"
	@echo "- Key macro trends affecting the portfolio (Fed policy, inflation, rates)"
	@echo "- Sector-level impacts (utilities, semiconductors, data centers, gold)"
	@echo "- Currency and commodity impacts"
	@echo "- Geopolitical risks"
	@echo ""
	@echo "## 3. Portfolio Status (포트폴리오 현황)"
	@echo "- Stock-by-stock summary table with:"
	@echo "  * Logic Status"
	@echo "  * Valuation"
	@echo "  * Expected Return"
	@echo "  * DCA Allocation"
	@echo "  * Action (BUY/HOLD/PAUSE/EXIT)"
	@echo "- Current vs target allocation"
	@echo ""
	@echo "## 4. Action Plan (실행 계획)"
	@echo "- DCA adjustments for next period"
	@echo "- Specific buy/sell/hold decisions with rationale"
	@echo "- Position sizing recommendations"
	@echo "- New investment ideas to research"
	@echo ""
	@echo "## 5. Risk Assessment (리스크 평가)"
	@echo "- Portfolio-level risks"
	@echo "- Macro triggers to watch"
	@echo "- Stop-loss or exit conditions"
	@echo ""
	@echo "## 6. Sources & Data Quality"
	@echo "- List all key data sources with dates"
	@echo "- Note any data gaps or uncertainties"
	@echo ""
	@echo "Generate the report in Korean and save to:"
	@echo "checklist/history/FINAL_REPORT_$(TODAY).md"
	@echo ""
	@echo "The report should be actionable, concise, and ready for immediate use in investment decisions."
	@echo ""
	@echo "━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━"
	@echo ""
	@echo "$(GREEN)✓ Final report prompt displayed. Please copy and paste to Claude.$(NC)"

# Run all three analyses
all: macro-report checklist final-report
	@echo ""
	@echo "$(GREEN)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo "$(GREEN)✓ All three tasks completed successfully$(NC)"
	@echo "$(GREEN)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo ""
	@echo "Generated files:"
	@echo "  1. $(MACRO_REPORT)"
	@echo "  2. $(CHECKLIST_REPORT)"
	@echo "  3. $(FINAL_REPORT)"

# Quick reference
info:
	@echo "$(BLUE)Current Configuration:$(NC)"
	@echo "  Today: $(TODAY)"
	@echo "  Macro Script: $(MACRO_SCRIPT)"
	@echo "  Macro Reports Dir: $(MACRO_REPORTS_DIR)"
	@echo "  Checklist File: $(CHECKLIST_FILE)"
	@echo "  Checklist History Dir: $(CHECKLIST_HISTORY_DIR)"
	@echo ""
	@echo "$(BLUE)Output Files:$(NC)"
	@echo "  Macro Report: $(MACRO_REPORT)"
	@echo "  Checklist Report: $(CHECKLIST_REPORT)"
	@echo "  Final Report: $(FINAL_REPORT)"

# Check if required files exist
check:
	@echo "$(YELLOW)Checking required files...$(NC)"
	@test -f $(MACRO_SCRIPT) && echo "$(GREEN)✓$(NC) $(MACRO_SCRIPT)" || echo "$(RED)✗$(NC) $(MACRO_SCRIPT) not found"
	@test -f $(CHECKLIST_FILE) && echo "$(GREEN)✓$(NC) $(CHECKLIST_FILE)" || echo "$(RED)✗$(NC) $(CHECKLIST_FILE) not found"
	@test -d $(CHECKLIST_HISTORY_DIR) && echo "$(GREEN)✓$(NC) $(CHECKLIST_HISTORY_DIR) exists" || echo "$(YELLOW)⚠$(NC) History directory not found"
	@test -d $(MACRO_REPORTS_DIR) && echo "$(GREEN)✓$(NC) $(MACRO_REPORTS_DIR) exists" || echo "$(YELLOW)⚠$(NC) Macro reports directory not found"

# Clean up temporary files (be careful!)
clean:
	@echo "$(YELLOW)This will remove generated temporary files.$(NC)"
	@echo "$(RED)WARNING: This will NOT delete report files.$(NC)"
	@echo ""
	@echo "Nothing to clean (reports are kept)."

# Create a quick start guide
guide:
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo "$(GREEN)Investment Analysis Quick Start Guide$(NC)"
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
	@echo ""
	@echo "$(YELLOW)1. Generate Macro Report$(NC)"
	@echo "   Command: make macro-report"
	@echo "   Purpose: Research macroeconomic conditions (Fed policy, inflation, currencies)"
	@echo "   Output:  macro/reports/REPORT_$(TODAY).md"
	@echo ""
	@echo "$(YELLOW)2. Run Portfolio Checklist$(NC)"
	@echo "   Command: make checklist"
	@echo "   Purpose: Analyze each stock (logic, valuation, recommendations)"
	@echo "   Output:  checklist/history/REPORT_$(TODAY).md"
	@echo ""
	@echo "$(YELLOW)3. Generate Final Combined Report$(NC)"
	@echo "   Command: make final-report"
	@echo "   Purpose: Synthesize macro + checklist into actionable summary"
	@echo "   Output:  checklist/history/FINAL_REPORT_$(TODAY).md"
	@echo "   Note:    Requires both macro and checklist reports to exist"
	@echo ""
	@echo "$(YELLOW)4. Run All Three$(NC)"
	@echo "   Command: make all"
	@echo "   Purpose: Generate all reports in sequence"
	@echo ""
	@echo "$(YELLOW)5. Check Status$(NC)"
	@echo "   Command: make check"
	@echo "   Purpose: Verify all required files exist"
	@echo ""
	@echo "$(GREEN)Recommended Workflow:$(NC)"
	@echo "  1. cd investment/"
	@echo "  2. make check            # Verify setup"
	@echo "  3. make macro-report     # Generate macro report (copy prompt to Claude)"
	@echo "  4. make checklist        # Generate portfolio report (copy prompt to Claude)"
	@echo "  5. make final-report     # Generate combined report (copy prompt to Claude)"
	@echo ""
	@echo "$(GREEN)Quick Workflow:$(NC)"
	@echo "  make all                 # Run all three steps"
	@echo ""
	@echo "$(BLUE)━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━$(NC)"
